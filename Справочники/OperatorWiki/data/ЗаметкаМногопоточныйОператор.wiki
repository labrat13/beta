++ Заметка Многопоточный Оператор

Многопоточный Оператор - это новый, следующий большой релиз, после переделки ГУЯ.
Сейчас я хочу перенести старый движок Оператора на новый Windows GUI, с поддержкой многопоточности.
Сейчас надо отработать ГУЙ, а потом уже браться за переделку всего движка.

А вот тут я накидываю многопоточный Движок, использующий этот новый ГУЙ.
См концепцию КонсольОператора, только я ее еще не написал. В ней есть Диалог, один на всех, он собственно и есть КонсольОператора с точки зрения потока-Исполнителя команды. 

+++Менеджер и Исполнители
Это абстракция для пользователя, делающая управление работой Оператора близким к естественному языку.
* todo: вот этот текст про Исполнителей вынести в отдельную тему, Концепцию, документ. Тут еще много работы.
Один поток - Менеджер, другие - Исполнители.


Менеджер изначально владеет Диалогом, из него он принимает команды с Консоли Оператора.
- question: а он блокируется на ожидании Диалога?
- сейчас выборка команд делается по регексу каждой команды из общего списка команд в памяти. 
  А надо держать список в БД, получать из БД выборку команд. 
  По соответствию их регекса и текста запроса.
  - а потом уже на этот список отобранных команд науськивать созданный для этого поток-Исполнитель.
  - а эта предварительная выборка - лишняя работа? ведь надо выполнить регексы для всех Команд БД.
    А сейчас - тоько половину в среднем - сейчас процедуры перебираются и сразу запускаются на исполнение.
    И уже в процессе исполнения отсеиваются неподходящие по прочим условиям, помимо регекса.
  - todo: тут надо думать, как разделить поиск Процедуры и ее исполнение на разные этапы!

Еще, нужен ПулИсполнителей.
Это список объектов, описывающих потоки-Исполнители.
Имена Исполнителей должны храниться в Настройках Оператора в виде имен через запятую с пробелом.
Пример: Джон, Джек, Мальборо, Салли.
- question: пользователь будет вводить их с маленькой буквы. 
Так что, наверно, потребуются склонения этих имен. как это сделано для Мест.
-- но тогда их не будет так просто хранить в строке имен в настройках Оператора.
При запуске Движка список имен Исполнителей из настроек парсится и для них создаются потоки-Исполнители и помещаются в ПулИсполнителей. 


+++Если Исполнители - фиксированный набор
Набор потоков-Исполнителей можно задать в коде.
* можно жестко задать 4 или 8 Исполнителей, и эти команды управления Исполнителями вроде как не нужны.
	* Показать Исполнителей = Показать исполняемые задания, это нужная команда.
	* Отменить задание исполнителя Х = Отменить задание Х, это тоже нужная команда.
	* Показать свободных исполнителей != Показать исполняемые задания, но тоже естественно удобно.
	* Исполнитель Х свободен? = проверка доступных ресурсов исполнения задачи.
	* только команды Создать исполнителя и Удалить исполнителя - оказываются не нужны.
* достоинство - всякие склонения имен исполнителей можно прямо в коде прописать. Так себе фича...
* недостаток - пользователю не нравится запоминать имена виртуальных персонажей. 
Хотя в играх он вполне их принимает. Да и вообще, в жизни имена не выбирают.
  Если он сможет сам их назначать, будет прикольно.
* question: Эти команды, получается, управляют Оператором. Значит, они системные, а не пользовательские.
 И их названия нельзя изменять?
	* их процедуры надо реализовать в сборке системных процедур, а тексты команд можно в БД как хочешь изменять.
	* да и команды управления питанием - тоже так же надо реализовать.
	 

+++Если Исполнителей назначает Пользователь 
Имена Исполнителей может назначать сам пользователь. 
Командой "Создать исполнителя Джон" или "Нанять исполнителя Джона".
Можно удалить Исполнителя командой "Удалить исполнителя джона" или "Уволить исполнителя Джон".
- тогда соответствующий поток удаляется из ПулИсполнителей и уничтожается.
- а если он занят работой, то выдается сообщение "Исполнитель Джон исполняет Задание Название задания. Сначала отмените задание Исполнителя." 

+++При запуске команды:
* Если ПулИсполнителей пустой 
(пользователь удалил всех Исполнителей почему-то, или сбой произошел, или яхз еще что)
то в Консоль выводится сообщение "Нет ни одного Исполнителя. Создайте Исполнителя командой "Создать исполнителя Имя"".
* Если ПулИсполнителей не пустой, но в нем нет свободного Исполнителя, то в Консоль выводится сообщение:
 "Все Исполнители заняты! 
  а) создайте нового Исполнителя командой "Создать исполнителя Имя";
  б) подождите, пока какой-либо Исполнитель завершит свое задание и освободится.
  в) просмотрите список Исполнителей командой "Показать Исполнителей", 
выберите Исполнителя, задание которого можно отменить, 
и отмените задание командой "Отменить задание исполнителя Имя"."

* question: А как можно отменить задание исполнителя, если оно им не управляется?
Например, Процедура - это запуск утилиты упаковки каталога. 
Там есть только командная строка приложения и максимум - можно завершить процесс приложения, по его описателю Process.
	* Тут над этим еще надо работать. Определить, как можно управлять приложением через его объект Process.
* А как передать сигнал отмены в уже запущенный поток-Исполнитель?
	* особенно если он уже не исполняет алгоритм Процедуры, а спит на WaitForSingleObject() ? 

+++Перегрузка ресурсов компьютера
В окне Консоли еще надо периодически выводить значения системных ресурсов: RAM, размер файла подкачки, загрузку процессора, свободное место на дисках, процент загруженности дисков.
Чтобы пользователь не увлекался многозадачностью, а то это не очевидно в консоли.
* можно ограничить исполнение введенных команд при превышени пределов по диску, ОЗУ, итп. 
  CPU вот не такой критичный ресурс, да и если он занят, 
   то пользователь просто не сможет ввести новую команду. 
* да у меня все утилиты. программы и игры загружают комп под завязку - они так
  подбираются мною, чтобы хоть по одной - работали. Какая тут многозадачность?
* надо просто выводить значения системных ресурсов на панель на форме. По таймеру раз в секунду. 
  Таймер там запланирован уже, для часов. Надо только организовать вывод и панель для этого.
* Полезна была бы команда "Показать нагрузку компьютера" с этими данными о загрузке компа.
  Она была бы прототипом этой индикации.
   
 